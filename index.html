<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Massage Wellness Survey</title>
<script src="https://unpkg.com/@supabase/supabase-js"></script>
    
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');

  body {
    font-family: 'Poppins', sans-serif;
    margin: 0;
    background-color: #f8f7f5;
    color: #333;
    overflow-x: hidden;
  }

  /* ===== PRELOADER ===== */
  .preloader {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background-color: #f8f7f5;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
  }

  .preloader .spinner {
    border: 4px solid #ddd;
    border-top: 4px solid #bfa074;
    border-radius: 50%;
    width: 45px;
    height: 45px;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  /* ===== LANDING ===== */
  .landing {
    height: 100vh;
    background: linear-gradient(rgba(0,0,0,0.55), rgba(0,0,0,0.45)),
                url('https://images.unsplash.com/photo-1587502537745-84b9b9a5a5b1?auto=format&fit=crop&w=1600&q=80') center/cover no-repeat;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    color: #fff;
    padding: 20px;
    animation: fadeIn 1.2s ease;
  }

  .logo {
    width: 100px;
    height: 100px;
    background: url('https://cdn-icons-png.flaticon.com/512/6807/6807885.png') center/contain no-repeat;
    margin-bottom: 25px;
    filter: drop-shadow(0 3px 8px rgba(0,0,0,0.3));
  }

  h1 {
    font-size: 44px;
    margin-bottom: 15px;
    font-weight: 700;
    letter-spacing: 1px;
    text-shadow: 0 3px 8px rgba(0,0,0,0.5);
  }

  p {
    font-size: 18px;
    max-width: 550px;
    margin: 0 auto 40px;
    line-height: 1.6;
    color: #f8f8f8;
    text-shadow: 0 2px 6px rgba(0,0,0,0.5);
  }

  .google-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    background: #fff;
    color: #444;
    border-radius: 50px;
    padding: 14px 30px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    box-shadow: 0 6px 20px rgba(0,0,0,0.2);
    transition: all 0.3s ease;
  }

  .google-btn:hover {
    transform: scale(1.07);
    background: #fafafa;
  }

  .google-btn img {
    width: 22px;
    margin-right: 10px;
  }

  footer {
    position: absolute;
    bottom: 15px;
    width: 100%;
    text-align: center;
    color: rgba(255,255,255,0.85);
    font-size: 14px;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* ===== RESPONSIVE ===== */
  @media (max-width: 768px) {
    h1 { font-size: 32px; }
    p { font-size: 16px; }
    .google-btn { padding: 12px 25px; font-size: 15px; }
    .logo { width: 80px; height: 80px; }
  }
</style>
</head>
<body>

<!-- ===== PRELOADER ===== -->
<div class="preloader" id="preloader">
  <div class="spinner"></div>
</div>

<!-- ===== LANDING PAGE ===== -->
<section class="landing" id="landingPage">
  <div class="logo"></div>
  <h1>Welcome to Serenity Touch Massage</h1>
  <p>Youâ€™re about to take a quick 2-minute survey to help us improve your relaxation experience.  
     Your honest input helps us serve you better.</p>

  <div class="google-btn" onclick="window.location.href='signin.html'">

    <img src="https://www.svgrepo.com/show/355037/google.svg" alt="Google logo">
    Sign in with Google to Continue
  </div>
</section>

<footer>Â© 2025 Serenity Touch Wellness. All rights reserved.</footer>

  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
const SUPABASE_URL = "https://bipnmthaonkbffothwkj.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJpcG5tdGhhb25rYmZmb3Rod2tqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3OTc0NDUsImV4cCI6MjA3NTM3MzQ0NX0.9mNaxvZolgyyvyZP7n2x_nUwL8h1EHknpjR4_aMlPyc";
const client = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

let deviceId = localStorage.getItem("device_id");
if (!deviceId) {
  deviceId = "dev-" + Math.random().toString(36).substring(2) + Date.now();
  localStorage.setItem("device_id", deviceId);
}

async function getDeviceInfo() {
  const ua = navigator.userAgent;
  let deviceModel = /android/i.test(ua)
    ? "Android"
    : /iphone|ipad|ipod/i.test(ua)
    ? "iOS"
    : /windows/i.test(ua)
    ? "Windows"
    : /mac/i.test(ua)
    ? "Mac"
    : /linux/i.test(ua)
    ? "Linux"
    : "Unknown";

  let browserName = "Unknown";
  if (ua.includes("Chrome") && !ua.includes("Edg")) browserName = "Chrome";
  else if (ua.includes("Safari") && !ua.includes("Chrome")) browserName = "Safari";
  else if (ua.includes("Firefox")) browserName = "Firefox";
  else if (ua.includes("Edg")) browserName = "Edge";

  let ip = "Unknown";
  try {
    const res = await fetch("https://api.ipify.org?format=json");
    const j = await res.json();
    ip = j.ip;
  } catch (e) {
    console.warn("IP fetch failed:", e);
  }

  return { deviceModel, browserName, ip };
}

async function ensureLandingRecord() {
  console.log("ðŸŸ¡ Checking record for:", deviceId);
  const { data: existing, error: selErr } = await client
    .from("logins")
    .select("*")
    .eq("device_id", deviceId)
    .maybeSingle();
  if (selErr) console.error("Select error:", selErr);

  const info = await getDeviceInfo();
  const record = {
    device_id: deviceId,
    page_name: "landing",
    login_status: "visited",
    is_active: true,
    device_model: info.deviceModel,
    ip_address: info.ip,
    browser_name: info.browserName,
  };

  if (!existing) {
    console.log("ðŸŸ¢ No record found â€” inserting new");
    const { error } = await client.from("logins").insert(record);
    if (error) console.error("Insert error:", error);
    else console.log("âœ… Inserted new landing record");
  } else {
    console.log("ðŸŸ¢ Record exists â€” updating");
    const { error } = await client.from("logins").update(record).eq("device_id", deviceId);
    if (error) console.error("Update error:", error);
    else console.log("âœ… Updated existing landing record");
  }
}

window.addEventListener("load", async () => {
  console.log("ðŸŒ Page fully loaded, starting submissionâ€¦");
  const preloader = document.getElementById("preloader");

  try {
    await ensureLandingRecord();
    console.log("âœ¨ Submission complete, hiding preloader");
  } catch (err) {
    console.error("Submission failed:", err);
  } finally {
    // hide loader after a short delay for visual smoothness
    setTimeout(() => preloader.style.display = "none", 500);
  }
});
</script>






</body>
</html>
